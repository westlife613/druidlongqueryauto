# 📋 AWS控制台部署检查清单

使用本清单确保每个步骤都已完成。

---

## ✅ 第一阶段：本地准备

- [ ] 已修改 `DruidLongQueryExample.java` 中的数据库配置
  - [ ] RDS终端节点
  - [ ] 数据库用户名
  - [ ] 数据库密码
- [ ] 已修改测试SQL（main方法中）
- [ ] 已运行 `mvn clean package`
- [ ] JAR文件存在于 `target/` 目录
- [ ] JAR文件大小正常（10-20MB）

---

## ✅ 第二阶段：AWS资源创建

### EC2实例
- [ ] 已选择正确的AWS区域（与RDS相同）
- [ ] 已创建EC2实例
  - [ ] 实例名称：`druid-test`
  - [ ] AMI：Amazon Linux 2023 或 Amazon Linux 2
  - [ ] 实例类型：t3.small 或 t2.micro
  - [ ] 已下载并保存密钥对 (.pem文件)
  - [ ] 安全组允许SSH（端口22）
  - [ ] 实例有公有IP地址
- [ ] 实例状态为"正在运行"

### S3存储桶
- [ ] 已创建S3存储桶
  - [ ] 存储桶名称：___________________________
  - [ ] 区域与EC2相同
- [ ] 已上传JAR文件到S3
- [ ] 已上传 `quick-start-ec2.sh` 到S3

### IAM角色
- [ ] 已创建IAM角色：`EC2-S3-Access`
  - [ ] 权限策略：AmazonS3ReadOnlyAccess
  - [ ] 受信任实体：EC2
- [ ] 已将IAM角色附加到EC2实例
- [ ] 已等待1-2分钟让角色生效

---

## ✅ 第三阶段：网络配置

### 安全组配置
- [ ] 已记录EC2安全组ID：sg-_______________
- [ ] 已记录RDS安全组ID：sg-_______________

### RDS安全组入站规则
- [ ] 已添加入站规则：
  - [ ] 类型：MySQL/Aurora（或对应的数据库类型）
  - [ ] 端口：3306（或对应端口）
  - [ ] 源：EC2安全组ID

### 连接测试
- [ ] 可以SSH连接到EC2（或使用Instance Connect）
- [ ] EC2可以ping通RDS（如果允许ICMP）
- [ ] 可以从EC2使用MySQL客户端连接RDS

---

## ✅ 第四阶段：部署和运行

### 文件下载
- [ ] 已连接到EC2实例
- [ ] Java已安装（`java -version` 有输出）
- [ ] 已从S3下载JAR文件
  - [ ] 文件名：app.jar
  - [ ] 文件存在于当前目录
- [ ] 已下载快速启动脚本
- [ ] 已修改脚本中的S3存储桶名称
- [ ] 已设置脚本执行权限（`chmod +x`）

### 程序运行
- [ ] 已运行 `./quick-start-ec2.sh` 或 `java -jar app.jar`
- [ ] 程序正常启动（没有立即报错）
- [ ] 可以看到日志输出或日志文件已创建

---

## ✅ 第五阶段：测试和验证

### 功能测试
- [ ] 程序成功连接到数据库
- [ ] 可以看到连接池初始化信息
- [ ] 查询正常执行（或预期的错误出现）
- [ ] 日志中显示了测试进度

### 断连测试（根据选择的场景）
- [ ] 场景1：单次长查询 - 已执行
- [ ] 场景2：长查询+空闲等待 - 已执行
- [ ] 场景3：连续多次查询 - 已执行
- [ ] 场景4：获取连接后等待 - 已执行

### 结果收集
- [ ] 已保存完整日志
- [ ] 已记录错误信息（如果有）
- [ ] 已记录断连时间点（如果出现）
- [ ] 已下载日志到本地或上传到S3

---

## ✅ 第六阶段：清理（测试完成后）

### 资源清理
- [ ] 已停止EC2实例（或终止）
- [ ] 已删除不需要的S3文件
- [ ] 已删除测试用的安全组（如果不再需要）
- [ ] 已删除IAM角色（如果不再需要）

### 成本检查
- [ ] 已确认没有运行中的EC2实例
- [ ] 已确认S3存储在合理范围内
- [ ] 已设置AWS预算告警（可选）

---

## 📝 关键信息记录

### AWS资源信息
```
AWS区域：___________________________
EC2实例ID：i-______________________
EC2公有IP：________________________
EC2安全组：sg-_____________________
S3存储桶名：_______________________
IAM角色名：________________________
```

### 数据库信息
```
RDS终端节点：______________________
数据库类型：_______________________
数据库名称：_______________________
数据库端口：_______________________
RDS安全组：sg-_____________________
```

### 测试配置
```
测试场景：_________________________
测试SQL：__________________________
预期结果：_________________________
实际结果：_________________________
```

---

## 🆘 问题排查检查清单

如果遇到问题，按此清单检查：

### 连接问题
- [ ] EC2实例正在运行
- [ ] 安全组配置正确
- [ ] 网络ACL未阻止流量
- [ ] RDS实例正在运行
- [ ] RDS可公开访问设置正确（如从互联网访问）

### 权限问题
- [ ] IAM角色已附加到EC2
- [ ] IAM角色有正确的权限策略
- [ ] S3存储桶策略允许访问
- [ ] 数据库用户有正确的权限

### 程序问题
- [ ] Java版本正确（8或以上）
- [ ] JAR文件完整（未损坏）
- [ ] 数据库连接配置正确
- [ ] 依赖库完整

### 网络问题
- [ ] DNS解析正常（`nslookup rds-endpoint`）
- [ ] 端口通畅（`telnet rds-endpoint 3306`）
- [ ] 路由表配置正确
- [ ] 互联网网关配置正确（如需要）

---

## ✅ 最终确认

- [ ] 所有测试已完成
- [ ] 日志已保存
- [ ] 问题已记录
- [ ] 资源已清理
- [ ] 费用已检查

**测试日期**: ____________

**测试人员**: ____________

**结果**: ☐ 成功  ☐ 失败  ☐ 部分成功

**备注**: 
_____________________________________
_____________________________________
_____________________________________
